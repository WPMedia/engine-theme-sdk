import Version from '../src/utils/Version';
import { Meta } from '@storybook/addon-docs/blocks';

<Meta title="Intro" />

# Engine SDK 

<Version />

Itâ€™s a collection of React components designed to:

- Speed up design and development velocity
- Help create consistent and usable functionality in our various websites
- Promote best practices for accessibility and responsive web design

We hope to accomplish these goals by:

- Reducing the number of decisions needed when iterating on UI
- Reducing the amount of code duplication in our apps
- Providing easy-to-use and extensible components for anyone to consume

### **Resources**

- [Github](https://github.com/WPMedia/engine-theme-sdk)

- [Releases](https://github.com/WPMedia/engine-theme-sdk/releases)



## Install

Engine SDK components are written in React and Typescript, and its stories are written in [MDX Format](https://storybook.js.org/docs/formats/mdx-syntax/). It requires Storybook version 6.0.0-beta.26 and up.

Add Engine SDK to your project.

`npm install --save @wpmedia/engine-theme-sdk`

Add to your `blocks.json`.

`@wpmedia/engine-theme-sdk@version`

### **Use**

Add engine-theme-sdk your block's `package.json` dependencies

```
"dependencies": {
    "@wpmedia/engine-theme-sdk": "latest"
  },
```

Import components you want into your block

`import { ImageMetadata } from '@wpmedia/engine-theme-sdk';`

and use them like so

```
  <ImageMetadata subtitle={subtitle} caption={caption} credits={credits} />
```


### **Local Development**

You can test Engine SDK components locally by adding the following properties to your `blocks.json`:
-  `"useLocal": true`
-  `"useLocalEngineSDK": true`


## Contribute
If you need to update an existing Engine SDK component, contact the Pagebuilder team. If you want to create a new component follow these instructions:
1. Pull the latest `staging` branch

    - `git checkout staging`

    - `git fetch -a`
2. Branch off the `staging` branch
    - `git checkout -b PEN-[jira ticket num]-[brief description of feature]`
3. Create a new folder `YourComponentName` under `src/components`.
4. Implement your component in a `index.tsx` file. Remember to add an `interface` with your component's props and add `proptypes` for type checking.
5. Implement unit tests for your component in a `index.test.tsx` file. Remember to use your component [locally](https://staging.arcpublishing.com/alc/docs/storybooks/engine-theme-sdk/?path=/story/intro--page#local-development) to test the changes.
6. Document your component by creating a new story `YourComponentName.stories.mdx` under `stories/`.
    - Run `npm run storybook` to verify your story was created
7. When your component is ready make a PR against `staging`, get approval for your PR, then follow the [publishing](https://staging.arcpublishing.com/alc/docs/storybooks/engine-theme-sdk/?path=/story/intro--page#how-to-publish) steps.

## How To Publish

If you have updated an existing SDK component or you have just created a new component, follow these steps for the component to be available for use.

1. Merge your branch into the `staging` branch.

2. Run the publishing commands in the `staging` branch

    - `npm version prerelease --preid=beta`

    - `npm publish --tag beta`

2. Go to your project's `blocks.json`
    - Change your `"engineSDK"` field to the `@beta` release:
         `"@wpmedia/engine-theme-sdk"` -> `"@wpmedia/engine-theme-sdk@beta"`.
    - Make a PR against `master` on your project's repo. 
    - Create a new bundle of your project with `npx fusion zip` and deploy the bundle to your environment
    - Alert quality assurance stakeholder that the change has been published.

3. After design QA and QA approval, make a PR from the `staging` branch to the `master` branch.

4. Once the PR has been approved, merge the `staging` branch to `master`. 
    - In master, you can publish against what's changed.
    - `npm publish`

5. Prepare your production release
    - Update your `blocks.json` to use the production release instead of the beta release `"@wpmedia/engine-theme-sdk"`
    - Create a new bundle of your project with `npx fusion zip` and deploy the bundle to your environment
    - Alert quality assurance stakeholder that the change has been published.


### **Resources**

- [Read more about dist tags via npm.](https://docs.npmjs.com/adding-dist-tags-to-packages)

## Deploy to ALC

Engine Theme SDK automatically deploys its Storybook documentation to ALC when it's merged with the `staging` branch.
Documentation is available [here](https://staging.arcpublishing.com/alc/docs/storybooks/engine-theme-sdk/?path=/story/intro--page). 
If you wish to manually update the documentation on Arc Learning Center, you have to upload it to S3 by following these steps:
1. Run `npm run build-storybook` on `engine-theme-sdk`. This will generate a static storybook build in `/storybook-static`.
2. Open the [WP-ARC AWS Console](https://console.aws.amazon.com/s3/buckets/arc-learning-center-static/docs/?region=us-east-1&tab=overview#) (you might need to authenticate with OKTA first).
3. Go to `storybooks`, then `engine-theme-sdk` and click on `Upload`.
4. Upload your files to replace the contents of `engine-theme-sdk` with your new build. Make sure to include the `sb_dll` folder generated in the build.
5. Click on `Next` and go through the uploading process with the default settings.
6. After a minute your changes will be live on [ALC](https://staging.arcpublishing.com/alc/docs/storybooks/engine-theme-sdk/?path=/story/intro--page).
